import{b as T,S as $,m as S}from"./base-map-XmSAiI59.js";import{g as x}from"./index-65EKp3sw.js";import{d as w,r as E}from"./index-CC-wYX1C.js";import{g as P,o as D,h as F,k as B,_ as O}from"./app-WXFCxs9o.js";import{u as A,i as H,a as j,b as q,c as R}from"./installCanvasRenderer-aGLZOOUQ.js";var W=Object.defineProperty,z=(h,f)=>W(h,"name",{value:f,configurable:!0});function C(h,f,L={}){var e=x(h),r=x(f),y=w(r[1]-e[1]),v=w(r[0]-e[0]),_=w(e[1]),u=w(r[1]),p=Math.pow(Math.sin(y/2),2)+Math.pow(Math.sin(v/2),2)*Math.cos(_)*Math.cos(u);return E(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),L.units)}z(C,"distance");var N=C;const Y=P({__name:"pie",setup(h){A([H,j,q]);const f={style:$.GRAY,center:[107.744809,30.180706],zoom:6,minZoom:4},L=e=>{const r="point-source",v=new S.Popup({closeButton:!1,closeOnClick:!1,offset:[0,-40]});e.addSource(r,{type:"geojson",data:B("/data/point.geojson"),cluster:!0,clusterRadius:85}),e.addLayer({id:"earthquake_circle",type:"circle",source:r,paint:{"circle-radius":0}}),e.on("data",t=>{t.sourceId!==r||!t.isSourceLoaded||(e.on("move",p),e.on("moveend",p),p())});const _={};let u={};async function p(){const t={},c=e.querySourceFeatures(r),d=e.getSource(r);for(let o=0;o<c.length;o++){const n=c[o],l=n.geometry.coordinates;let a,s;n.properties&&n.properties.cluster?(a=n.properties.cluster_id,s=await b(a,d,n)):(s=n.properties,a=s.id);let i=_[a];i||(s.coords=l,i=_[a]=new S.Marker({element:I(s)}).setLngLat(l)),t[a]=i,u[a]||i.addTo(e)}for(const o in u)t[o]||u[o].remove();u=t}function I(t){const c=document.createElement("div");c.style.width="80px",c.style.height="80px";const d=R(c),{name:o,coords:n}=t;return d.setOption({title:{show:!0,text:o.length>4?`${o.substring(0,3)}··`:o,left:"center",top:"center",textStyle:{fontSize:12,textShadowBlur:5,textShadowColor:"#3EAF7C"},padding:0,shadowColor:"rgba(0, 0, 0, 0.5)",shadowBlur:10},color:["#FFD273","#E86D68","#A880FF"],series:[{type:"pie",name:`${o}|${n}`,radius:["40%","96%"],center:["50%","50%"],hoverAnimation:!1,label:{show:!0,position:"inside",formatter:"{c}"},labelLine:{show:!1},data:[{value:t.v1,name:"土豆"},{value:t.v2,name:"玉米"},{value:t.v3,name:"红薯"}]}]}),d.on("mouseover",l=>{const{seriesName:a,data:s}=l,i=a.split("|"),M=i[0],m=i[1].split(",").map(k=>Number(k)),g=`<p style="padding: 0 10px;">${M}: ${s.name} ${s.value} 万顷</p>`;v.setLngLat(m).setHTML(g).addTo(e)}),d.on("mouseout",()=>{v.remove()}),c}function b(t,c,d){return new Promise((o,n)=>{c.getClusterLeaves(t,30,0,(l,a)=>{l&&n(l);let s=1/0,i=0;for(let m=0;m<a.length;m++){const g=N(d,a[m]);g<s&&(i=m,s=g)}const M=a[i].properties;o(M)})})}};return(e,r)=>(D(),F(T,{"map-options":f,onLoad:L}))}}),Q=O(Y,[["__file","pie.vue"]]);export{Q as default};

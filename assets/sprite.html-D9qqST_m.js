import{_ as s,c as a,a as e,o as p}from"./app-COZMOXYE.js";const t={};function o(i,n){return p(),a("div",null,n[0]||(n[0]=[e(`<h1 id="雪碧图" tabindex="-1"><a class="header-anchor" href="#雪碧图"><span>雪碧图</span></a></h1><blockquote><p><a href="https://docs.mapbox.com/mapbox-gl-js/style-spec/sprite/" target="_blank" rel="noopener noreferrer">sprite</a></p></blockquote><p>如果图层样式中有使用 <code>background-pattern</code>、<code>fill-pattern</code>、<code>line-pattern</code>、<code>fill-extrusion-pattern</code>、或 <code>icon-image</code> 属性，则必须设置该属性。例如：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// Style property</span></span>
<span class="line"><span class="token string-property property">&#39;sprite&#39;</span><span class="token operator">:</span> <span class="token string">&#39;https://naivemap.com/mapbox/sprite&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// Layout property of SymbolLayer</span></span>
<span class="line"><span class="token string-property property">&#39;icon-image&#39;</span><span class="token operator">:</span> <span class="token string">&#39;cat&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="雪碧图文件" tabindex="-1"><a class="header-anchor" href="#雪碧图文件"><span>雪碧图文件</span></a></h2><p>一个有效的雪碧图必须包含两种文件：索引和图片。在加载时，会自动生成完整的 URLs：</p><ul><li><a href="https://api.mapbox.com/styles/v1/mapbox/light-v9/sprite.json?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA" target="_blank" rel="noopener noreferrer">https://naivemap.com/mapbox/sprite.json</a> 和 <a href="https://api.mapbox.com/styles/v1/mapbox/light-v9/sprite.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA" target="_blank" rel="noopener noreferrer">http://naivemap.com/mapbox/sprite.png</a> 或</li><li><a href="https://api.mapbox.com/styles/v1/mapbox/light-v9/sprite@2x.json?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA" target="_blank" rel="noopener noreferrer">https://naivemap.com/mapbox/sprite@2x.json</a> 和 <a href="https://api.mapbox.com/styles/v1/mapbox/light-v9/sprite@2x.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA" target="_blank" rel="noopener noreferrer">https://naivemap.com/mapbox/sprite@2x.png</a>（高 DPI 设备）</li></ul><h2 id="添加-创建雪碧图" tabindex="-1"><a class="header-anchor" href="#添加-创建雪碧图"><span>添加/创建雪碧图</span></a></h2><p>通常我们会使用一些自己的图标，下面介绍几种使用自定义图标的方法：</p><h3 id="mapbox-gl-js-api" tabindex="-1"><a class="header-anchor" href="#mapbox-gl-js-api"><span>Mapbox GL JS API</span></a></h3><h4 id="addimage" tabindex="-1"><a class="header-anchor" href="#addimage"><span>addImage</span></a></h4><p>通过 <a href="https://docs.mapbox.com/mapbox-gl-js/api/#map#addimage" target="_blank" rel="noopener noreferrer">map.addImage()</a> 方法向样式中添加图标。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">map<span class="token punctuation">.</span><span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token string">&#39;./images/cat.png&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> image</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> error</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">.</span><span class="token function">hasImage</span><span class="token punctuation">(</span><span class="token string">&#39;cat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span><span class="token string">&#39;cat&#39;</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，当样式所需的图标丢失时将会触发 <a href="https://docs.mapbox.com/mapbox-gl-js/api/#map.event:styleimagemissing" target="_blank" rel="noopener noreferrer">styleimagemissing</a> 事件，通过该事件可添加指定 <code>id</code> 图标。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;styleimagemissing&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> id <span class="token operator">=</span> e<span class="token punctuation">.</span>id <span class="token comment">// 丢失图片 id</span></span>
<span class="line">  map<span class="token punctuation">.</span><span class="token function">loadImage</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> image</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">throw</span> error</span>
<span class="line">    map<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> image<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>示例：<a href="https://docs.mapbox.com/mapbox-gl-js/example/add-image-missing-generated/" target="_blank" rel="noopener noreferrer">Generate and add a missing icon to the map</a></p></blockquote><h3 id="mapbox-studio" tabindex="-1"><a class="header-anchor" href="#mapbox-studio"><span>Mapbox Studio</span></a></h3><p>最直接的方法就是在 <a href="https://studio.mapbox.com/" target="_blank" rel="noopener noreferrer">Mapbox Studio</a> 中上传、管理图标。然后在样式预览中，将 <code>sprite.png</code>、<code>sprite@2x.png</code>、<code>sprite.json</code> 和 <code>sprite@2x.json</code> 文件下载下来使用。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><ol><li>只支持<code>svg</code>格式，可以在 <a href="https://www.iconfont.cn/" target="_blank" rel="noopener noreferrer">iconfont</a> 下载图标上传</li><li>官方推荐的地图图标集：<a href="https://labs.mapbox.com/maki-icons/" target="_blank" rel="noopener noreferrer">MAKI ICONS</a></li></ol></div><h3 id="spritezero" tabindex="-1"><a class="header-anchor" href="#spritezero"><span>spritezero</span></a></h3><p>也可以使用 <a href="https://github.com/mapbox/spritezero" target="_blank" rel="noopener noreferrer">spritezero</a> 工具生成雪碧图文件。</p><ol><li>安装</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">npm</span> <span class="token function">install</span> @mapbox/spritezero</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>在 <code>Ubuntu</code> 安装成功，<code>Windows</code> 安装失败</p></blockquote><ol start="2"><li>使用</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">var</span> spritezero <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@mapbox/spritezero&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;glob&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pxRatio</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> svgs <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;input/*.svg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">svg</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">id</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;.svg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">var</span> pngPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;output/sprite@&#39;</span> <span class="token operator">+</span> pxRatio <span class="token operator">+</span> <span class="token string">&#39;.png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">var</span> jsonPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;output/sprite@&#39;</span> <span class="token operator">+</span> pxRatio <span class="token operator">+</span> <span class="token string">&#39;.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Pass \`true\` in the layout parameter to generate a data layout</span></span>
<span class="line">  <span class="token comment">// suitable for exporting to a JSON sprite manifest file.</span></span>
<span class="line">  spritezero<span class="token punctuation">.</span><span class="token function">generateLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">imgs</span><span class="token operator">:</span> svgs<span class="token punctuation">,</span> <span class="token literal-property property">pixelRatio</span><span class="token operator">:</span> pxRatio<span class="token punctuation">,</span> <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> dataLayout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line">    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>jsonPath<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dataLayout<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Pass \`false\` in the layout parameter to generate an image layout</span></span>
<span class="line">  <span class="token comment">// suitable for exporting to a PNG sprite image file.</span></span>
<span class="line">  spritezero<span class="token punctuation">.</span><span class="token function">generateLayout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">imgs</span><span class="token operator">:</span> svgs<span class="token punctuation">,</span> <span class="token literal-property property">pixelRatio</span><span class="token operator">:</span> pxRatio<span class="token punctuation">,</span> <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> imageLayout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    spritezero<span class="token punctuation">.</span><span class="token function">generateImage</span><span class="token punctuation">(</span>imageLayout<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line">      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>pngPath<span class="token punctuation">,</span> image<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><ol><li>注意<code>node</code>版本<code>v10</code>及以上</li><li>如果需要将<code>png</code>转换为雪碧图，需要修改 <a href="https://github.com/mapbox/spritezero/blob/main/lib/generate.js#L124" target="_blank" rel="noopener noreferrer">spritezero</a> 源码，将<code>mapnik.Image.fromSVGBytes</code>修改为<code>mapnik.Image.fromBytes</code>即可</li><li>该库提供了命令行工具：<a href="https://github.com/mapbox/spritezero-cli" target="_blank" rel="noopener noreferrer">spritezero-cli</a>，可直接从文件夹生成雪碧图</li><li><a href="https://docs.mapbox.com/help/troubleshooting/using-recolorable-images-in-mapbox-maps/" target="_blank" rel="noopener noreferrer">SDF icons</a>： <ul><li>在 <code>generateLayout</code> 给 <code>dataLayout</code> 添加属性： <code>sdf: true</code></li><li><a href="https://github.com/mapbox/spritezero/pull/66" target="_blank" rel="noopener noreferrer">Option to generate SDF sprites</a>、<a href="https://github.com/elastic/spritezero" target="_blank" rel="noopener noreferrer">@elastic/spritezero</a></li><li><a href="http://www.npeihl.com/maki-sdf-sprites/" target="_blank" rel="noopener noreferrer">Demo of SDF sprites</a> :::</li></ul></li></ol></div>`,28)]))}const c=s(t,[["render",o],["__file","sprite.html.vue"]]),r=JSON.parse('{"path":"/style-spec/sprite.html","title":"雪碧图","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"雪碧图文件","slug":"雪碧图文件","link":"#雪碧图文件","children":[]},{"level":2,"title":"添加/创建雪碧图","slug":"添加-创建雪碧图","link":"#添加-创建雪碧图","children":[{"level":3,"title":"Mapbox GL JS API","slug":"mapbox-gl-js-api","link":"#mapbox-gl-js-api","children":[]},{"level":3,"title":"Mapbox Studio","slug":"mapbox-studio","link":"#mapbox-studio","children":[]},{"level":3,"title":"spritezero","slug":"spritezero","link":"#spritezero","children":[]}]}],"git":{"updatedTime":1669447413000,"contributors":[{"name":"huangli","username":"huangli","email":"naivemap@163.com","commits":1,"url":"https://github.com/huangli"},{"name":"huanglii","username":"huanglii","email":"li.huangli@qq.com","commits":6,"url":"https://github.com/huanglii"},{"name":"huangli","username":"huangli","email":"li.huangli@qq.com","commits":1,"url":"https://github.com/huangli"},{"name":"黄俐","username":"黄俐","email":"li.huangli@qq.com","commits":4,"url":"https://github.com/黄俐"},{"name":"huanglii","username":"huanglii","email":"849151701@qq.com","commits":5,"url":"https://github.com/huanglii"},{"name":"huangli","username":"huangli","email":"849151701@qq.com","commits":1,"url":"https://github.com/huangli"}]},"filePathRelative":"style-spec/sprite.md"}');export{c as comp,r as data};

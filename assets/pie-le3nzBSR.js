import{b as T,S as B,m as C}from"./base-map-OfSqYvf7.js";import{g as b}from"./index-c_NJVKPv.js";import{d as M,r as E}from"./index-CaSe04H2.js";import{k as O,q as D,_ as F,l as P,o as q}from"./app-DKmThjjR.js";import{u as A,i as j,a as H,b as R,c as W}from"./installCanvasRenderer-D3OlsG20.js";function z(L,h,w={}){var c=b(L),d=b(h),a=M(d[1]-c[1]),l=M(d[0]-c[0]),x=M(c[1]),_=M(d[1]),f=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(x)*Math.cos(_);return E(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),w.units)}var N=z;const Y=O({__name:"pie",setup(L,{expose:h}){h(),A([H,R,W]);const d={mapOptions:{style:B.GRAY,center:[107.744809,30.180706],zoom:6,minZoom:4},handleMapLoaded:a=>{const l="point-source",_=new C.Popup({closeButton:!1,closeOnClick:!1,offset:[0,-40]});a.addSource(l,{type:"geojson",data:D("/data/point.geojson"),cluster:!0,clusterRadius:85}),a.addLayer({id:"earthquake_circle",type:"circle",source:l,paint:{"circle-radius":0}}),a.on("data",e=>{e.sourceId!==l||!e.isSourceLoaded||(a.on("move",S),a.on("moveend",S),S())});const f={};let v={};async function S(){const e={},i=a.querySourceFeatures(l),p=a.getSource(l);for(let t=0;t<i.length;t++){const n=i[t],u=n.geometry.coordinates;let o,s;n.properties&&n.properties.cluster?(o=n.properties.cluster_id,s=await $(o,p,n)):(s=n.properties,o=s.id);let r=f[o];r||(s.coords=u,r=f[o]=new C.Marker({element:k(s)}).setLngLat(u)),e[o]=r,v[o]||r.addTo(a)}for(const t in v)e[t]||v[t].remove();v=e}function k(e){const i=document.createElement("div");i.style.width="80px",i.style.height="80px";const p=j(i),{name:t,coords:n}=e;return p.setOption({title:{show:!0,text:t.length>4?`${t.substring(0,3)}··`:t,left:"center",top:"center",textStyle:{fontSize:12,textShadowBlur:5,textShadowColor:"#3EAF7C"},padding:0,shadowColor:"rgba(0, 0, 0, 0.5)",shadowBlur:10},color:["#FFD273","#E86D68","#A880FF"],series:[{type:"pie",name:`${t}|${n}`,radius:["40%","96%"],center:["50%","50%"],hoverAnimation:!1,label:{show:!0,position:"inside",formatter:"{c}"},labelLine:{show:!1},data:[{value:e.v1,name:"土豆"},{value:e.v2,name:"玉米"},{value:e.v3,name:"红薯"}]}]}),p.on("mouseover",u=>{const{seriesName:o,data:s}=u,r=o.split("|"),y=r[0],m=r[1].split(",").map(I=>Number(I)),g=`<p style="padding: 0 10px;">${y}: ${s.name} ${s.value} 万顷</p>`;_.setLngLat(m).setHTML(g).addTo(a)}),p.on("mouseout",()=>{_.remove()}),i}function $(e,i,p){return new Promise((t,n)=>{i.getClusterLeaves(e,30,0,(u,o)=>{u&&n(u);let s=1/0,r=0;for(let m=0;m<o.length;m++){const g=N(p,o[m]);g<s&&(r=m,s=g)}const y=o[r].properties;t(y)})})}},BaseMap:T};return Object.defineProperty(d,"__isScriptSetup",{enumerable:!1,value:!0}),d}});function G(L,h,w,c,d,a){return q(),P(c.BaseMap,{"map-options":c.mapOptions,onLoad:c.handleMapLoaded})}const V=F(Y,[["render",G],["__file","pie.vue"]]);export{V as default};
